<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.nexters.rezoom.repository.QuestionRepository">

	<delete id="deleteAllQuestion"> <!-- 문항 전체 삭제 -->
	delete from question 
	where user_id=#{userId} AND resume_id=#{resumeId};
	</delete>
	
	<delete id="deleteQuestion"> <!-- 문항 개별 삭제 -->
	delete from question 
	where user_id=#{userId} AND resume_id=#{resumeId} AND question_id=#{questionId};
	</delete>
	
	<insert id="createQuestion" parameterType="com.nexters.rezoom.domain.Question" useGeneratedKeys="true" keyProperty="question.questionId">
	<!-- 문항 등록 (question_id, resume_id, user_id, title, content 순)-->
	insert into question (resume_id, user_id, title, content) 
	values(#{question.resumeId}, #{question.userId}, #{question.title}, #{question.content});
	</insert><!--question id 부분 지우고 insert뒤에 컬럼명써주기 -->
	
	<select id="getQuestion" resultType="com.nexters.rezoom.domain.Question"><!-- 문항 상세보기 -->
		select question_id questionId, resume_id resumeId, user_id userId, title, content 
		from question where user_id=#{userId} AND resume_id=#{resumeId} AND question_id=#{questionId};
	</select>
	
	<select id="updateQuestion" ><!-- 문항 수정 -->
		update question 
		set title=#{question.title}, content=#{question.content}  
		where question_id=#{question.questionId};
	</select>

	<!-- 동작됨 -->
	<insert id="insertHashTag">
		INSERT INTO hashtag (hash_keyword, user_id) VALUES
		<foreach collection="list" item="item" separator=",">
			( #{item, jdbcType=VARCHAR},
			#{userId}
			)
		</foreach>
	</insert>
	ㄴ
	<select id="getHashId" resultType="java.util.HashMap">
		SELECT hash_id FROM hashtag WHERE user_id = #{userId}
	</select>

	<insert id="insertQuestionHash">
		INSERT INTO question_has_hashtag (question_id, resume_id, user_id, hash_id) VALUES
		<foreach collection="list" item="item" separator=",">
			(
				#{questionId}, #{resumeId}, #{userId}, #{item, jdbcType=NUMBERIC}
			)
		</foreach>
	</insert>
</mapper>